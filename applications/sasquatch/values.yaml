# Default values for Sasquatch.

# Override strimzi-kafka subchart configuration.
strimzi-kafka: {}

schema-registry:
  # -- Whether to enable the schema-registry subchart
  enabled: false

schema-registry-remote:
  # -- Whether to enable schema-registry-remote, an instance
  # of the schema-registry for remote topics
  enabled: false

influxdb:
  # -- Whether InfluxDB is enabled
  enabled: true

  image:
    # -- InfluxDB image tag
    tag: "1.11.8"

  livenessProbe:
    # -- Liveness probe initial delay in seconds
    initialDelaySeconds: 180

  persistence:
    # -- Whether to use persistent volume claims. By default, `storageClass`
    # is undefined, choosing the default provisioner (standard on GKE).
    enabled: true

    # -- Persistent volume size
    # @default -- 1TiB for teststand deployments
    size: 1Ti

  setDefaultUser:
    # -- Whether the default InfluxDB user is set
    enabled: true

    user:
      # -- Use `influxdb-user` and `influxdb-password` keys from this secret
      existingSecret: sasquatch

  ingress:
    # -- Whether to enable the InfluxDB ingress
    enabled: false

    # -- Whether to obtain TLS certificates for the ingress hostname
    tls: false

    # -- Hostname of the ingress
    # @default -- None, must be set if the ingress is enabled
    hostname: ""

    # -- Annotations to add to the ingress
    # @default -- See `values.yaml`
    annotations:
      nginx.ingress.kubernetes.io/rewrite-target: /$2

    # -- Ingress class to use
    className: "nginx"

    # -- Path for the ingress
    # @default -- `"/influxdb(/\|$)(.*)"`
    path: "/influxdb(/|$)(.*)"

  securityContext:
    runAsNonRoot: true
    runAsUser: 1500
    runAsGroup: 1500
    fsGroup: 1500

  # See https://docs.influxdata.com/influxdb/v1.8/administration/config
  config:
    data:
      # -- Maximum size a shared cache can reach before it starts rejecting
      # writes
      cache-max-memory-size: 0

      # -- Duration a write will wait before fsyncing. This is useful for
      # slower disks or when WAL write contention is present.
      wal-fsync-delay: "100ms"

      # -- Whether to enable verbose logging of additional debug information
      # within the TSM engine and WAL
      trace-logging-enabled: true

      # -- Maximum number of series allowed per database before writes are
      # dropped. Change the setting to 0 to allow an unlimited number of series per
      # database.
      max-series-per-database: 0

    http:
      # -- Whether to enable the HTTP endpoints
      enabled: true

      # -- Whether to enable the Flux query endpoint
      flux-enabled: true

      # -- Whether authentication is required
      auth-enabled: true

      # -- Maximum number of rows the system can return from a non-chunked
      # query (0 is unlimited)
      max-row-limit: 0

    coordinator:
      # -- Duration a write request waits before timeout is returned to the
      # caller
      write-timeout: "1h"

      # -- Maximum number of running queries allowed on the instance (0 is
      # unlimited)
      max-concurrent-queries: 500

      # -- Maximum duration a query is allowed to run before it is killed
      query-timeout: "15s"

      # -- Maximum duration a query can run before InfluxDB logs it as a slow
      # query
      log-queries-after: "15s"

    continuous_queries:
      # -- Whether continuous queries are enabled
      enabled: false

    logging:
      # -- Logging level
      level: "debug"
      # -- Format to use for log messages
      format: "json"

  initScripts:
    # -- Whether to enable the InfluxDB custom initialization script
    enabled: false

    # # -- InfluxDB custom initialization script.
    # scripts:
    #   init.iql: |+

  # -- Kubernetes resource requests and limits
  # @default -- See `values.yaml`
  resources:
    requests:
      memory: 4Gi
      cpu: 1
    limits:
      memory: 8Gi
      cpu: 2

customInfluxDBIngress:
  # -- Whether to enable the custom ingress for InfluxDB OSS
  enabled: false

  # -- Hostname of the ingress
  # @default -- None, must be set if the ingress is enabled
  hostname: ""

  # -- Annotations to add to the ingress
  # @default -- See `values.yaml`
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /$2

  # -- Path for the ingress
  # @default -- `"/influxdb(/\|$)(.*)"`
  path: "/influxdb(/|$)(.*)"

influxdb-enterprise:
  # -- Whether to enable influxdb-enterprise
  enabled: false

influxdb-enterprise-standby:
  # -- Whether to enable influxdb-enterprise-standby
  enabled: false

influxdb-enterprise-active:
  # -- Whether to enable influxdb-enterprise-active
  enabled: false
  #
kafka-connect-manager:
  # -- Whether to enable the Kafka Connect Manager
  enabled: false

telegraf:
  # -- Whether to enable the telegraf subchart
  enabled: false

telegraf-standby:
  # -- Whether to enable the telegraf-standby subchart
  enabled: false

rest-proxy:
  # -- Whether to enable the REST proxy
  enabled: false

chronograf:
  # -- Whether to enable Chronograf
  enabled: true

  image:
    # -- Docker image to use for Chronograf
    repository: "quay.io/influxdb/chronograf"

    # -- Docker tag to use for Chronograf
    tag: 1.10.9

  updateStrategy:
    # -- Deployment strategy, use recreate with persistence enabled
    type: "Recreate"

  persistence:
    # -- Whether to enable persistence for Chronograf data
    enabled: true

    # -- Size of data store to request, if enabled
    size: 100Gi

  ingress:
    # -- Whether to enable the Chronograf ingress
    enabled: false

    # -- Whether to obtain TLS certificates for the ingress hostname
    tls: false

    # -- Hostname of the ingress
    # @default -- None, must be set if the ingress is enabled
    hostname: ""

    # -- Ingress class to use
    className: "nginx"

    # -- Path for the ingress
    # @default -- `"/chronograf"`
    path: "/chronograf"

  # -- Additional environment variables for Chronograf
  # @default -- See `values.yaml`
  env:
    HOST_PAGE_DISABLED: true
    BASE_PATH: /chronograf
    INACTIVITY_DURATION: 1h

  # -- Name of secret to use. The keys `generic_client_id`,
  # `generic_client_secret`, and `token_secret` should be set.
  envFromSecret: "sasquatch"

  # -- Kubernetes resource requests and limits for Chronograf
  # @default -- See `values.yaml`
  resources:
    requests:
      memory: 2Gi
      cpu: 1
    limits:
      memory: 4Gi
      cpu: 2

kapacitor:
  # -- Whether to enable Kapacitor
  enabled: true

  image:
    # -- Docker image to use for Kapacitor
    repository: docker.io/library/kapacitor
    # -- Tag to use for Kapacitor
    tag: 1.8.2
    # -- Pull policy for Kapacitor
    pullPolicy: "IfNotPresent"

  strategy:
    # -- Deployment strategy, use recreate with persistence enabled
    type: "Recreate"

  persistence:
    # -- Whether to enable Kapacitor data persistence
    enabled: true
    # -- Size of storage to request if enabled
    size: 100Gi

  # -- InfluxDB connection URL
  influxURL: http://sasquatch-influxdb.sasquatch:8086

  # -- Enable Squadcast alerts
  # @default -- False. If set to true, you need to create the URL as a secret
  squadcast:
    enabled: false

  # -- Use `influxdb-user` and `influxdb-password` keys from this secret
  existingSecret: sasquatch

  # -- Additional environment variables to set
  # @default -- See `values.yaml`
  envVars:
    KAPACITOR_SLACK_ENABLED: true
    KAPACITOR_AS_ROOT: true

  # -- Kubernetes resource requests and limits for Kapacitor
  # @default -- See `values.yaml`
  resources:
    requests:
      memory: 1Gi
      cpu: 1
    limits:
      memory: 2Gi
      cpu: 2

kafdrop:
  # -- Whether to enable the kafdrop subchart
  enabled: true

kafdrop-remote:
  # -- Whether to enable the kafdrop-remote, an instance of kafdrop for
  # remote topics
  enabled: false
  kafka:
    # -- Kafka user to use for kafdrop-remote
    user: "kafdrop-remote"
    # -- Prefixes of the remote topics kafdrop-remote has access to.
    # @default -- None, must be set if enabled
    topicPrefixes: null

squareEvents:
  # -- Enable the Square Events subchart with topic and user configurations
  enabled: false

backup:
  # -- Whether to enable the backups subchart
  enabled: false

tap:
  # -- Whether to enable the tap subchart
  enabled: false

ppdbtap:
  # -- Whether to enable the ppdbtap subchart
  enabled: false

obsenv:
  # -- Whether to enable the obsenv subchart
  enabled: false

backpack:
  # -- Whether to enable the backpack subchart
  enabled: false

prompt-processing:
  # -- Whether to enable the prompt-processing subchart
  enabled: false

control-system:
  # -- Whether to enable the control-system subchart
  enabled: false

obsloctap:
  # -- Whether to enable the obsloctap subchart
  enabled: false

consdb:
  # -- Whether to enable the consdb subchart
  enabled: false

scimma:
  # -- Whether to enable the scimma subchart
  enabled: false

data-transfer-monitoring:
  # -- Whether to enable the data-transfer-monitoring subchart
  enabled: false

app-metrics:
  # -- Enable the app-metrics subchart with topic, user, and telegraf
  # configurations
  enabled: false

  # -- The apps to create configuration for.
  apps: []

grafana:
  # -- Whether to enable the grafana subchart
  enabled: false

trickster:
  # -- Whether to enable trickster
  enabled: false
  # -- Number of Trickster replicas
  replicaCount: 3
  image:
    # -- Trickster Docker image tag
    # @default -- the chart appVersion
    tag: main
  podLabels:
    # -- Label to identify that Trickster is using the Sasquatch Redis instance
    sasquatch-redis-client: 'true'
  config:
    frontend:
      # -- Port to listen on for Trickster's requests
      listen_port: 8480
    caches:
      default:
        # -- Cache type used by Trickster (see docs for details)
        provider: redis
        redis:
          endpoint: sasquatch-redis:6379
    negative_caches:
      general:
        # -- Negative cache configuration (see docs for details)
        "400": 3s
        "404": 3s
        "500": 3s
        "502": 3s
    backends:
      default:
        # -- Backend type used by Trickster (see docs for details)
        provider: influxdb
        # -- Base upstream URL for all proxied requests
        origin_url: http://sasquatch-influxdb.sasquatch:8086
        # -- Name of the cache to use with this backend
        cache_name: default
        # -- Name of the negative cache to use with this backend
        negative_cache_name: general
        # -- Maximum number of recent timestamps to cache for a given query
        # @default 1024
        timeseries_retention_factor: 1024
        # -- Relative expiration of cached timeseries data
        # @default is 6h
        timeseries_ttl: 6h
    logging:
      # -- Log verbosity level (debug, info, warn, error)
      # @default -- info
      log_level: info
    metrics:
      # -- Port to listen on for Trickster's metrics endpoint /metrics
      # -- @default -- 8481
      listen_port: 8481
  persistentVolume:
    # -- Whether to enable persistence for Trickster cache data.
    # This is not needed when using Redis as a backend.
    enabled: false
  resources:
    # -- Kubernetes resource requests and limits for Trickster
    requests:
      memory: 256Mi
      cpu: 100m
    # -- Kubernetes resource limits for Trickster
    limits:
      memory: 512Mi
      cpu: 200m

redis:
  # -- Whether to enable the ephemeral Redis instance for Trickster
  enabled: false
  persistence:
    # -- Whether to persist Redis storage of ephemeral data.
    # This should be false to use emptyDir for better performance.
    enabled: false

  # -- Resource limits and requests for the ephemeral Redis pod
  # @default -- See `values.yaml`
  resources:
    requests:
      cpu: "100m"
      memory: "256Mi"
    limits:
      cpu: "200m"
      memory: "512Mi"

  # -- Affinity rules for the ephemeral Redis pod
  affinity: {}

  # -- Node selection rules for the ephemeral Redis pod
  nodeSelector: {}

  # -- Pod annotations for the ephemeral Redis pod
  podAnnotations: {}

global:
  # -- Host name for ingress
  # @default -- Set by Argo CD
  host: null

  # -- Base path for Vault secrets
  # @default -- Set by Argo CD
  vaultSecretsPath: null
