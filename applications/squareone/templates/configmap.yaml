apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "squareone.fullname" . }}
  labels:
    {{- include "squareone.labels" . | nindent 4 }}
data:
  squareone.config.yaml: |
    siteName: {{ .Values.config.siteName | quote }}
    baseUrl: {{ .Values.global.baseUrl | quote }}
    environmentName: {{ .Values.global.environmentName | quote }}
    siteDescription: {{ .Values.config.siteDescription | quote }}
    docsBaseUrl: {{ .Values.config.docsBaseUrl | quote }}
    showPreview: {{ .Values.config.showPreview }}
    {{- if .Values.config.semaphoreUrl }}
    semaphoreUrl: {{ .Values.config.semaphoreUrl | quote }}
    {{- end}}
    {{- if .Values.config.timesSquareUrl }}
    timesSquareUrl: {{ .Values.config.timesSquareUrl | quote }}
    {{- end}}
    {{- if .Values.config.coManageRegistryUrl }}
    coManageRegistryUrl: {{ .Values.config.coManageRegistryUrl | quote }}
    {{- end}}
    {{- if .Values.config.plausibleDomain }}
    plausibleDomain: {{ .Values.config.plausibleDomain | quote }}
    {{- end}}
    {{- if .Values.config.sentryDsn }}
    sentryDsn: {{ .Values.config.sentryDsn | quote }}
    {{- end}}
    sentryTracesSampleRate: {{ .Values.config.sentryTracesSampleRate }}
    sentryReplaysSessionSampleRate: {{ .Values.config.sentryReplaysSessionSampleRate }}
    sentryReplaysOnErrorSampleRate: {{ .Values.config.sentryReplaysOnErrorSampleRate }}
    sentryDebug: {{ .Values.config.sentryDebug }}
    enableAppsMenu: {{ .Values.config.enableAppsMenu }}
    appLinks:
      {{- toYaml .Values.config.appLinks | nindent 6 }}
    mdxDir: "/etc/squareone/mdx-content"
    {{- if .Values.config.headerLogoUrl }}
    headerLogoUrl: {{ .Values.config.headerLogoUrl | quote }}
    {{- else if .Values.config.headerLogoFile }}
      {{- $environmentName := .Values.global.environmentName }}
      {{- $logoPath := printf "content/%s/%s" $environmentName .Values.config.headerLogoFile }}
      {{- $logoContent := $.Files.Get $logoPath }}
      {{- if $logoContent }}
    headerLogoData: {{ $logoContent | b64enc | quote }}
        {{- $ext := .Values.config.headerLogoFile | splitList "." | last | lower }}
        {{- if eq $ext "png" }}
    headerLogoMimeType: "image/png"
        {{- else if or (eq $ext "jpg") (eq $ext "jpeg") }}
    headerLogoMimeType: "image/jpeg"
        {{- else if eq $ext "svg" }}
    headerLogoMimeType: "image/svg+xml"
        {{- else if eq $ext "webp" }}
    headerLogoMimeType: "image/webp"
        {{- else if eq $ext "gif" }}
    headerLogoMimeType: "image/gif"
        {{- end }}
      {{- end }}
    {{- else if .Values.config.headerLogoData }}
    headerLogoData: {{ .Values.config.headerLogoData | quote }}
      {{- if .Values.config.headerLogoMimeType }}
    headerLogoMimeType: {{ .Values.config.headerLogoMimeType | quote }}
      {{- end }}
    {{- end }}
    headerLogoHeight: {{ .Values.config.headerLogoHeight }}
    {{- if .Values.config.headerLogoWidth }}
    headerLogoWidth: {{ .Values.config.headerLogoWidth }}
    {{- end }}
    headerLogoAlt: {{ .Values.config.headerLogoAlt | quote }}
