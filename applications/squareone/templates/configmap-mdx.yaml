{{- $environmentName := .Values.global.environmentName -}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "squareone.fullname" . }}-mdx-content
  labels:
    {{- include "squareone.labels" . | nindent 4 }}
data:
{{- $files := list "api-aspect.mdx" "docs.mdx" "support.mdx" "enrollment__thanks-for-signing-up.mdx" "enrollment__thanks-for-verifying.mdx" "enrollment__pending-approval.mdx" "enrollment__pending-confirmation.mdx" "settings__index.mdx" }}
{{- range $fileName := $files }}
  {{- $envPath := printf "content/%s/%s" $environmentName $fileName }}
  {{- $fallbackPath := printf "content/idfprod/%s" $fileName }}
  {{- $content := "" }}
  {{- if $.Files.Get $envPath }}
    {{- $content = $.Files.Get $envPath }}
  {{- else if $.Files.Get $fallbackPath }}
    {{- $content = $.Files.Get $fallbackPath }}
  {{- end }}
  {{- if $content }}
  {{ $fileName | quote }}: |
{{ $content | nindent 4 }}
  {{- end }}
{{- end }}
