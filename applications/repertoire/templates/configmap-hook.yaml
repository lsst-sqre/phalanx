{{- if eq (include "repertoire.anyTapServerEnabled" .) "true" }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: "repertoire-hook-config"
  annotations:
    helm.sh/hook: "pre-install,pre-upgrade"
    helm.sh/hook-delete-policy: "before-hook-creation"
  labels:
    app.kubernetes.io/name: "repertoire"
data:
  config.yaml: |
    logLevel: {{ .Values.config.logLevel | quote }}
    logProfile: {{ .Values.config.logProfile | quote }}
    baseHostname: {{ .Values.global.host | quote }}
    tap:
      schemaVersion: {{ .Values.config.tap.schemaVersion | quote }}
      schemaSourceTemplate: {{ .Values.config.tap.schemaSourceTemplate | quote }}
      servers: {{ .Values.config.tap.servers | toJson }}
    metrics:
      enabled: false
      application: "repertoire"
    sentry:
      enabled: false
{{- end }}
