# Default values for repertoire.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# -- Number of web deployment pods to start
replicaCount: 1

image:
  # -- Image to use in the repertoire deployment
  repository: "ghcr.io/lsst-sqre/repertoire"

  # -- Pull policy for the repertoire image
  pullPolicy: "IfNotPresent"

  # -- Tag of image to use
  # @default -- The appVersion of the chart
  tag: null

config:
  # -- List of applications deployed in this Phalanx environment (do not set)
  # @default -- Set by Argo CD
  applications: []

  # -- Base hostname of the Phalanx environment (do not set)
  # @default -- Set by Argo CD
  baseHostname: null

  # -- Butler configuration mapping (do not set)
  # @default -- Set by Argo CD
  butlerConfigs: {}

  # -- List of datasets served by this environment. Each member of the list is
  # a dictionary with key `name` (human-readable short name of dataset like
  # `dp1`).
  datasets: []

  # -- Dictionary of InfluxDB database names to connection information for
  # that database, with keys `url`, `database`, `username`, `passwordKey`, and
  # `schemaRegistry`. `passwordKey` must match an entry in `secrets.yaml`.
  influxdbDatabases: {}

  # -- Logging level
  logLevel: "INFO"

  # -- Logging profile (`production` for JSON, `development` for
  # human-friendly)
  logProfile: "production"

  # -- URL path prefix
  pathPrefix: "/repertoire"

  # -- Rules for determining the expected URLs of deployed services that use
  # the main hostname. See the [Repertoire
  # documentation](https://repertoire.lsst.io/) for more information.
  # @default -- See `values.yaml`
  rules:
    argocd:
      - type: "ui"
        name: "argocd"
        template: "https://{{base_hostname}}/argo-cd"
    gafaelfawr:
      - type: "internal"
        name: "gafaelfawr"
        template: "https://{{base_hostname}}/auth/api/v1"
      - type: "ui"
        name: "tokens"
        template: "https://{{base_hostname}}/auth/tokens"
    hips:
      - type: "data"
        name: "hips"
        datasets:
          - "dp02"
          - "dp1"
        template: "https://{{base_hostname}}/api/hips/v2/{{dataset}}"
    mobu:
      - type: "internal"
        name: "mobu"
        template: "https://{{base_hostname}}/mobu"
    noteburst:
      - type: "internal"
        name: "noteburst"
        template: "https://{{base_hostname}}/noteburst/v1"
    nublado:
      - type: "ui"
        name: "nublado"
        template: "https://{{base_hostname}}/nb"
      - type: "ui"
        name: "webdav"
        template: "https://{{base_hostname}}/files"
    portal:
      - type: "ui"
        name: "portal"
        template: "https://{{base_hostname}}/portal/app/"
    semaphore:
      - type: "internal"
        name: "semaphore"
        template: "https://{{base_hostname}}/semaphore"
    sia:
      - type: "data"
        name: "sia"
        datasets:
          - "dp02"
          - "dp1"
        template: "https://{{base_hostname}}/api/sia/{{dataset}}"
    ssotap:
      - type: "data"
        name: "tap"
        datasets:
          - "dp03"
        template: "https://{{base_hostname}}/api/ssotap"
    tap:
      - type: "data"
        name: "tap"
        datasets:
          - "dp02"
          - "dp1"
        template: "https://{{base_hostname}}/api/tap"
    vo-cutouts:
      - type: "data"
        name: "cutout"
        datasets:
          - "dp02"
          - "dp1"
        template: "https://{{base_hostname}}/api/cutout"
    wobbly:
      - type: "internal"
        name: "wobbly"
        template: "https://{{base_hostname}}/wobbly"

  # -- Whether to send Slack alerts for unexpected failures
  slackAlerts: false

  # -- Rules for determining the expected URLs of deployed services that use a
  # subdomain. See the [Repertoire documentation](https://repertoire.lsst.io/)
  # for more information.
  # @default -- See `values.yaml`
  subdomainRules:
    nublado:
      - type: "ui"
        name: "nublado"
        template: "https://nb.{{base_hostname}}/nb"
      - type: "ui"
        name: "webdav"
        template: "https://{{base_hostname}}/files"

  # -- List of services that use subdomains instead of the main hostname. See
  # the [Repertoire documentation](https://repertoire.lsst.io/) for more
  # information.
  useSubdomains: []

ingress:
  # -- Additional annotations for the ingress rule
  annotations: {}

# -- Affinity rules for the repertoire deployment pod
affinity: {}

# -- Node selection rules for the repertoire deployment pod
nodeSelector: {}

# -- Annotations for the repertoire deployment pod
podAnnotations: {}

# -- Resource limits and requests for the repertoire deployment pod
# @default -- See `values.yaml`
resources: {}

# -- Tolerations for the repertoire deployment pod
tolerations: []

# The following will be set by parameters injected by Argo CD and should not
# be set in the individual environment values files.
global:
  # -- Host name for ingress
  # @default -- Set by Argo CD
  host: null

  # -- Base path for Vault secrets
  # @default -- Set by Argo CD
  vaultSecretsPath: null
