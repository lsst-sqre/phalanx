image:
  repository: ts-dockerhub.lsst.org/rapid-analysis
  tag: c0041
  pullPolicy: Always
location: SUMMIT
siteTag: summit
env:
  DAF_BUTLER_REPOSITORY_INDEX: /project/data-repos.yaml
  DEPLOY_BRANCH: deploy-summit
  LSST_RESOURCES_S3_PROFILE_butler: https://s3-butler.cp.lsst.org
  AWS_REQUEST_CHECKSUM_CALCULATION: WHEN_REQUIRED
securityContext:
  uid: 73006
  gid: 73006
  BUTLER_ROLLOUT_PAUSE: 1.0
scripts:
###
### AuxTel pods
###
# - name: summit/auxTel/runBackgroundService.py
#   mounts:
#   - auxtel-data
#   - auxtel-gen3-data
#   - allsky-data
#   - project-shared
#   resources:
#     requests:
#       cpu: 0.5
#       memory: 4G
#     limits:
#       cpu: 1.0
#       memory: 10G
- name: LATISS/runButlerWatcher.py
  mounts:
  - auxtel-data
  - auxtel-gen3-data
  - project-shared
- name: LATISS/runHeadNode.py
  mounts:
  - auxtel-data
  - auxtel-gen3-data
  - project-shared
- name: LATISS/runMetadataServer.py
  mounts:
  - auxtel-data
  - auxtel-gen3-data
  - project-shared
# - name: LATISS/runOneOffVisitImage.py
#   mounts:
#   - auxtel-data
#   - auxtel-gen3-data
#   - project-shared
- name: LATISS/runOneOffExpRecord.py
  mounts:
  - auxtel-data
  - auxtel-gen3-data
  - project-shared
- name: LATISS/runOneOffPostIsr.py
  mounts:
  - auxtel-data
  - auxtel-gen3-data
  - project-shared
  resources:
    requests:
      cpu: 1.0
      memory: 6G
    limits:
      cpu: 1.0
      memory: 12G
# - name: summit/auxTel/runCalibrateCcdRunner.py
#   mounts:
#   - auxtel-data
#   - auxtel-gen3-data
#   - project-shared
# - name: summit/auxTel/runImExaminer.py
#   mounts:
#   - auxtel-data
#   - auxtel-gen3-data
#   - project-shared
# - name: summit/auxTel/runIsrRunner.py
#   mounts:
#   - auxtel-data
#   - auxtel-gen3-data
#   - project-shared
# - name: summit/auxTel/runMetadataCreator.py
#   mounts:
#   - auxtel-data
#   - auxtel-gen3-data
#   - project-shared
# - name: summit/auxTel/runMetadataServer.py
#   mounts:
#   - auxtel-data
#   - auxtel-gen3-data
#   - project-shared
# - name: summit/auxTel/runMonitor.py
#   mounts:
#   - auxtel-data
#   - auxtel-gen3-data
#   - project-shared
#   resources:
#     requests:
#       cpu: 0.5
#       memory: 1G
#     limits:
#       cpu: 1.0
#       memory: 10G
# - name: summit/auxTel/runMountTorquePlotter.py
#   mounts:
#   - auxtel-data
#   - auxtel-gen3-data
#   - project-shared
# - name: summit/auxTel/runNightReporter.py
#   mounts:
#   - auxtel-data
#   - auxtel-gen3-data
#   - project-shared
# - name: summit/auxTel/runSpecExaminer.py
#   mounts:
#   - auxtel-data
#   - auxtel-gen3-data
#   - project-shared
#   resources:
#     requests:
#       cpu: 0.5
#       memory: 2G
#     limits:
#       cpu: 1.0
#       memory: 4G
###
### ComCamSim pods
###
# - name: LSSTComCamSim/runButlerWatcher.py
#   mounts:
#   - comcam-data
#   - comcam-gen3-data
#   - project-shared
# - name: LSSTComCamSim/runHeadNode.py
#   mounts:
#   - comcam-data
#   - comcam-gen3-data
#   - project-shared
# - name: LSSTComCamSim/runMetadataServer.py
#   mounts:
#   - comcam-data
#   - comcam-gen3-data
#   - project-shared
# - name: LSSTComCamSim/runPlotter.py
#   mounts:
#   - comcam-data
#   - comcam-gen3-data
#   - project-shared
#   resources:
#     requests:
#       cpu: 0.5
#       memory: 4G
#     limits:
#       cpu: 1.0
#       memory: 6G
###
### ComCam pods
###
# - name: LSSTComCam/runAosDonutPipeline.py
#   mounts:
#   - comcam-data
#   - comcam-gen3-data
#   - project-shared
#   resources:
#     requests:
#       cpu: 32
#       memory: 96G
#     limits:
#       cpu: 32
#       memory: 96G
# - name: LSSTComCam/runFocusSweepAnalysis.py
#   mounts:
#   - comcam-data
#   - comcam-gen3-data
#   - project-shared
#   resources:
#     requests:
#       cpu: 0.5
#       memory: 1G
#     limits:
#       cpu: 1
#       memory: 2G
# - name: LSSTComCam/runMetadataServerAos.py
#   mounts:
#   - comcam-data
#   - comcam-gen3-data
#   - project-shared
#   resources:
#     requests:
#       cpu: 0.25
#       memory: 500M
#     limits:
#       cpu: .5
#       memory: 1G
# - name: LSSTComCam/runOneOffExpRecord.py
#   mounts:
#   - comcam-data
#   - comcam-gen3-data
#   - project-shared
# - name: LSSTComCam/runOneOffPostIsr.py
#   mounts:
#   - comcam-data
#   - comcam-gen3-data
#   - project-shared
# - name: LSSTComCam/runOneOffVisitImage.py
#   mounts:
#   - comcam-data
#   - comcam-gen3-data
#   - project-shared
# - name: LSSTComCam/runPsfPlotting.py
#   mounts:
#   - comcam-data
#   - comcam-gen3-data
#   - project-shared
  # resources:
  #   requests:
  #     cpu: .5
  #     memory: 4G
  #   limits:
  #     cpu: 1
  #     memory: 6G
###
### Misc pods
###
- name: summit/misc/runAllSky.py
  mounts:
  - allsky-data
  - project-shared
  resources:
    requests:
      cpu: 2.0
      memory: 6G
    limits:
      cpu: 2.0
      memory: 8G
- name: summit/misc/runStarTracker.py
  mounts:
  - project-shared
- name: summit/misc/runStarTrackerCatchup.py
  mounts:
  - project-shared
  resources:
    requests:
      cpu: 1.0
      memory: 6G
    limits:
      cpu: 1
      memory: 8G
- name: summit/misc/runStarTrackerFast.py
  mounts:
  - project-shared
- name: summit/misc/runStarTrackerMetadata.py
  mounts:
  - project-shared
- name: summit/misc/runStarTrackerNightReport.py
  mounts:
  - project-shared
- name: summit/misc/runStarTrackerWide.py
  mounts:
  - project-shared
- name: summit/misc/runTmaTelemetry.py
  mounts:
  - project-shared
  resources:
    requests:
      cpu: 1
      memory: 6G
    limits:
      cpu: 1
      memory: 8G
# - name: summit/misc/runSoarSeeingUploader.py
#   mounts:
#   - project-shared
#   resources:
#     requests:
#       cpu: .5
#       memory: 2G
#     limits:
#       cpu: .5
#       memory: 2G
# - name: summit/misc/runSoarSeeingScraper.py
#   mounts:
#   - project-shared
#   resources:
#     requests:
#       cpu: .5
#       memory: 4G
#     limits:
#       cpu: .5
#       memory: 4G
###
### ComCam pods
###
# - name: LSSTComCam/runButlerWatcher.py
#   mounts:
#   - comcam-data
#   - comcam-gen3-data
#   - project-shared
# - name: LSSTComCam/runHeadNode.py
#   mounts:
#   - comcam-data
#   - comcam-gen3-data
#   - project-shared
# - name: LSSTComCam/runMetadataServer.py
#   mounts:
#   - comcam-data
#   - comcam-gen3-data
#   - project-shared
# - name: LSSTComCam/runPlotter.py
#   mounts:
#   - comcam-data
#   - comcam-gen3-data
#   - project-shared
###
### LSSTCam pods
###
- name: LSSTCam/runButlerWatcher.py
  mounts:
  - lsstcam-data
  - project-shared
- name: LSSTCam/runHeadNode.py
  mounts:
  - lsstcam-data
  - project-shared
- name: LSSTCam/runMetadataServer.py
  mounts:
  - lsstcam-data
  - project-shared
- name: LSSTCam/runOneOffExpRecord.py
  mounts:
  - lsstcam-data
  - project-shared
- name: LSSTCam/runOneOffPostIsr.py
  mounts:
  - lsstcam-data
  - project-shared
- name: LSSTCam/runOneOffVisitImage.py
  mounts:
  - lsstcam-data
  - project-shared
  resources:
    requests:
      cpu: 1
      memory: 4G
    limits:
      cpu: 1
      memory: 5G
- name: LSSTCam/runMetadataServerAos.py
  mounts:
  - lsstcam-data
  - project-shared
- name: LSSTCam/runMetadataServerRaPerformance.py
  mounts:
  - lsstcam-data
  - project-shared
- name: LSSTCam/runCleanup.py
  mounts:
  - lsstcam-data
  - project-shared
- name: LSSTCam/runPlotter.py
  mounts:
  - lsstcam-data
  - project-shared
  resources:
    requests:
      cpu: 1
      memory: 8G
    limits:
      cpu: 1
      memory: 12G
- name: LSSTCam/runPlotter2nd.py  # if we need a third make this a StatefulSet
  mounts:
  - lsstcam-data
  - project-shared
  resources:
    requests:
      cpu: 1
      memory: 8G
    limits:
      cpu: 1
      memory: 12G
- name: LSSTCam/runPsfPlotting.py
  mounts:
  - lsstcam-data
  - project-shared
  resources:
    requests:
      cpu: 1
      memory: 6G
    limits:
      cpu: 2
      memory: 10G
- name: LSSTCam/runPerformanceMonitor.py
  mounts:
  - lsstcam-data
  - project-shared
  resources:
    requests:
      cpu: 1
      memory: 6G
    limits:
      cpu: 1
      memory: 8G
- name: LSSTCam/runRadialPlotting.py
  mounts:
  - lsstcam-data
  - project-shared
  resources:
    requests:
      cpu: 1
      memory: 12G
    limits:
      cpu: 1.2
      memory: 16G
- name: LSSTCam/runFWHMPlotting.py
  mounts:
  - lsstcam-data
  - project-shared
  resources:
    requests:
      cpu: 1
      memory: 4G
    limits:
      cpu: 1
      memory: 6G
##
## LATISS StatefulSets
##
latissWorkerSet:
  name: LATISS/runSfmRunner.py
  mounts:
  - auxtel-data
  - auxtel-gen3-data
  - project-shared
  replicas: 5
  resources:
    requests:
      cpu: 1.0
      memory: 4G
    limits:
      cpu: 1.0
      memory: 8G
###
### ComCamSim StatefulSets
###
# comcamsimWorkerSet:
#   name: LSSTComCamSim/runSfmRunner.py
#   mounts:
#   - comcam-data
#   - comcam-gen3-data
#   - project-shared
#   replicas: 9
#   resources:
#     requests:
#       cpu: 1.0
#       memory: 4G
#     limits:
#       cpu: 1.0
#       memory: 8G
# comcamsimGather1bSet:
#   name: LSSTComCamSim/runStep1bWorker.py
#   mounts:
#   - comcam-data
#   - comcam-gen3-data
#   - project-shared
#   replicas: 1
#   resources:
#     requests:
#       cpu: 1.0
#       memory: 4G
#     limits:
#       cpu: 1.0
#       memory: 8G
# comcamsimGatherRollupSet:
#   name: LSSTComCamSim/runNightlyWorker.py
#   mounts:
#   - comcam-data
#   - comcam-gen3-data
#   - project-shared
#   replicas: 1
#   resources:
#     requests:
#       cpu: 1.0
#       memory: 12G
#     limits:
#       cpu: 1.0
#       memory: 24G
###
### ComCam StatefulSets
###
# comcamWorkerSet:
#   name: LSSTComCam/runSfmRunner.py
#   mounts:
#   - comcam-data
#   - comcam-gen3-data
#   - project-shared
#   replicas: 1
#   resources:
#     requests:
#       cpu: 1.0
#       memory: 4G
#     limits:
#       cpu: 1.0
#       memory: 8G
# comcamAosWorkerSet:
#   name: LSSTComCam/runAosWorker.py
#   mounts:
#   - comcam-data
#   - comcam-gen3-data
#   - project-shared
#   replicas: 1
#   resources:
#     requests:
#       cpu: 1.0
#       memory: 4G
#     limits:
#       cpu: 1.0
#       memory: 8G
# comcamGather1bSet:
#   name: LSSTComCam/runStep1bWorker.py
#   mounts:
#   - comcam-data
#   - comcam-gen3-data
#   - project-shared
#   replicas: 1
#   resources:
#     requests:
#       cpu: 1.0
#       memory: "4G"
#     limits:
#       cpu: 1.0
#       memory: "8G"
# comcamGather1bAosSet:
#   name: LSSTComCam/runStep1bAosWorker.py
#   mounts:
#   - comcam-data
#   - comcam-gen3-data
#   - project-shared
#   replicas: 1
#   resources:
#     requests:
#       cpu: 1.0
#       memory: "4G"
#     limits:
#       cpu: 1.0
#       memory: "8G"
# comcamGatherRollupSet:
#   name: LSSTComCam/runNightlyWorker.py
#   mounts:
#   - comcam-data
#   - comcam-gen3-data
#   - project-shared
#   replicas: 1
#   resources:
#     requests:
#       cpu: 1.0
#       memory: "12G"
#     limits:
#       cpu: 1.0
#       memory: "24G"
###
### LSSTCam StatefulSets
###
lsstcamWorkerSet:
  name: LSSTCam/runSfmRunner.py
  mounts:
  - lsstcam-data
  - project-shared
  replicas: 410
  resources:
    requests:
      cpu: 1.0
      memory: 4G
    limits:
      cpu: 1.0
      memory: 8G  # we should check this value
lsstcamAosWorkerSet:
  name: LSSTCam/runAosWorker.py
  mounts:
  - lsstcam-data
  - project-shared
  replicas: 32  # 4 deep for corner chips
  env:
    LIMITS_CPU: 2
  resources:
    requests:
      cpu: 1.0
      memory: 4G
    limits:
      cpu: 2.0
      memory: 8G
lsstcamGather1bSet:
  name: LSSTCam/runStep1bWorker.py
  mounts:
  - lsstcam-data
  - project-shared
  replicas: 5
  resources:
    requests:
      cpu: 1.0
      memory: "4G"
    limits:
      cpu: 1.0
      memory: "8G"
lsstcamGather1bAosSet:
  name: LSSTCam/runStep1bAosWorker.py
  mounts:
  - lsstcam-data
  - project-shared
  replicas: 5
  resources:
    requests:
      cpu: 1.0
      memory: "4G"
    limits:
      cpu: 1.0
      memory: "8G"
lsstcamGatherRollupSet:
  name: LSSTCam/runNightlyWorker.py
  mounts:
  - lsstcam-data
  - project-shared
  replicas: 1
  resources:
    requests:
      cpu: 1.0
      memory: "12G"
    limits:
      cpu: 1.0
      memory: "24G"
pullSecretsPath: pull-secret
butlerSecret:
  containerPath: /home/saluser/.lsst
  dbUser: oods
imagePullSecrets:
- name: pull-secret
nfsMountpoint:
- name: auxtel-data
  containerPath: /repo/LATISS
  readOnly: false
  server: nfs-auxtel.cp.lsst.org
  serverPath: /auxtel/repo/LATISS
- name: auxtel-gen3-data
  containerPath: /data/lsstdata/base/auxtel
  readOnly: true
  server: nfs-auxtel.cp.lsst.org
  serverPath: /auxtel/lsstdata/base/auxtel
- name: comcam-data
  containerPath: /repo/LSSTComCam
  readOnly: false
  server: nfs-comcam.cp.lsst.org
  serverPath: /comcam/repo/LSSTComCam
- name: comcam-gen3-data
  containerPath: /data/lsstdata/base/comcam
  readOnly: true
  server: nfs-comcam.cp.lsst.org
  serverPath: /comcam/lsstdata/base/comcam
- name: lsstcam-data
  containerPath: /repo/LSSTCam
  readOnly: false
  server: nfs-lsstcam.cp.lsst.org
  serverPath: /lsstcam/repo/LSSTCam
- name: lsstcam-gen3-data
  containerPath: /data/lsstdata/base/maintel
  readOnly: true
  server: nfs-lsstcam.cp.lsst.org
  serverPath: /lsstcam/lsstdata/base/maintel
- name: allsky-data
  containerPath: /data/allsky
  readOnly: true
  server: nfs-auxtel.cp.lsst.org
  serverPath: /auxtel/allsky
- name: project-shared
  containerPath: /project
  readOnly: false
  server: nfs-project.cp.lsst.org
  serverPath: /project
resources:
  requests:
    cpu: 0.5
    memory: 1G
  limits:
    cpu: 1.0
    memory: 2.5G
redis:
  enabled: true
  port: 6379
  env:
    MASTER: true
  envSecrets:
  - name: REDIS_PASSWORD
    secretName: rapid-analysis-secrets
    secretKey: redis-password
  storage:
    classname: rook-ceph-block
    request: 10Gi
  resources:
    requests:
      cpu: 100m
      memory: 1Gi
    limits:
      cpu: 1
      memory: 50Gi
squid:
  enabled: true
  embargo: true
  podAnnotations:
    k8s.v1.cni.cncf.io/networks: "kube-system/ra-lhn"
